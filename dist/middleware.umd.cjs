(function(n,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("camel-case")):typeof define=="function"&&define.amd?define(["exports","camel-case"],o):(n=typeof globalThis<"u"?globalThis:n||self,o(n.Middleware={}))})(this,function(n){"use strict";var O=Object.defineProperty;var S=(n,o,d)=>o in n?O(n,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[o]=d;var s=(n,o,d)=>(S(n,typeof o!="symbol"?o+"":o,d),d);class o{constructor(t,i,e){s(this,"args");this.validator=t,this.key=i,this.validator=t,this.args=typeof e=="string"?e.split(","):[].concat(...e||[])}async validate(t,i,e){return await this.validator(t,i,e,...this.args)}}class d{constructor(){s(this,"aliases");s(this,"groups");s(this,"middlewares",[]);s(this,"priorities",[]);this.aliases=new Map,this.middlewares=[],this.groups=new Map,this.priorities=[]}alias(t,i){return this.aliases.set(t,i),this}group(t,i){return this.groups.set(t,i),this}middleware(t){return this.middlewares.push(t),this}priority(t){return this.priorities=t,this}prioritize(t){return t.sort((i,e)=>{const a=this.priorities.indexOf(i.key||i.validator),l=this.priorities.indexOf(e.key||e.validator);return a>-1&&l>-1?a<l?-1:1:a>-1?-1:1})}resolve(t){return t.map(i=>{if(i instanceof o)return i;if(typeof i=="function")return new o(i);const[e,a]=this.definition(i),l=this.aliases.get(e);return l?new o(l,e,a):this.resolve(this.groups.get(e))}).flat(1)}definition(t){const[i,e]=t.split(":");return[i,e?e.split("."):[]]}prioritized(t){const i=this.resolve([...this.middlewares,...t]).filter(e=>e instanceof o);return this.prioritize(i)}}function g(r,t,i){return new Promise(async(e,a)=>{const l=[...r];return function c(p){const m=l.shift();return m?m.validate(t,i,u=>{u instanceof Error?a(u):u===!1?a(new Error(`Cancelling navigation to ${t.path}!`)):[!0,void 0].includes(u)?c(u):e(u)}):e(p)}()})}class f{constructor(t,i){s(this,"path");s(this,"children");s(this,"alias",[]);s(this,"name");s(this,"beforeEnter");s(this,"meta");s(this,"validators",[]);s(this,"callbacks",[]);this.registry=t,i.alias&&(this.alias=Array.isArray(i.alias)?i.alias:[i.alias]),this.path=i.path,this.children=i.children,this.name=i.name,this.beforeEnter=i.beforeEnter,this.meta=i.meta,this.beforeEnter=async(e,a,l)=>{const c=g(this.middlewares,e,a);for(const p of this.callbacks)p(c,{to:e,from:a,next:l});await c.then(l).catch(p=>{})}}get middlewares(){return this.registry.prioritized(this.validators)}middleware(...t){for(const i of t.flat(1))this.validators.push(i);return this}catch(t){return this.callbacks.push((i,{to:e,from:a,next:l})=>{i.catch(t&&(c=>t({error:c,to:e,from:a,next:l})))}),this}then(t,i){return this.callbacks.push((e,{to:a,from:l,next:c})=>{e.then(t&&(p=>t({status:p,to:a,from:l,next:c})),i&&(p=>i({error:p,to:a,from:l,next:c})))}),this}finally(t){return this.callbacks.push((i,{to:e,from:a,next:l})=>{i.finally(t&&(()=>t({to:e,from:a,next:l})))}),this}}class y extends f{constructor(i,e){super(i,e);s(this,"component");s(this,"props");this.component=e.component,this.props=e.props,this.path=e.path,this.name=e.name}}class w extends f{constructor(i,e){super(i,e);s(this,"component");s(this,"components");s(this,"props");this.registry=i,this.rawRoute=e,this.components=e.components,this.props=e.props,this.path=e.path,this.name=e.name}}class b extends f{constructor(i,e){super(i,e);s(this,"redirect");s(this,"component");s(this,"components");this.registry=i,this.rawRoute=e,this.redirect=e.redirect}}const h=new d;function v(r,t){return h.alias(r,t)}function M(r,t){return h.group(r,t)}function k(r){return h.middleware(r)}function E(r){return h.priority(r)}function z(r){return r.component?new y(h,r):r.components?new w(h,r):new b(h,r)}n.Middleware=o,n.MiddlewareRegistry=d,n.alias=v,n.group=M,n.middleware=k,n.priority=E,n.registrar=h,n.route=z,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=middleware.umd.cjs.map
